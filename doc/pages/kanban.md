# かんばんボード画面詳細設計書

## 1. 基本情報

### 1.1 画面情報

| 項目         | 内容                                     |
| ------------ | ---------------------------------------- |
| 画面 ID      | SCR004                                   |
| 画面名       | かんばんボード                           |
| 機能概要     | アクティブスプリントのストーリー進捗管理 |
| アクセス権限 | 一般ユーザー以上                         |

### 1.2 画面遷移

| 遷移元     | 遷移先     | 遷移条件           |
| ---------- | ---------- | ------------------ |
| バックログ | かんばん   | ボード表示クリック |
| かんばん   | バックログ | バックログクリック |

### 1.3 データ I/F

#### 1.3.1 使用テーブル

| テーブル名 | 用途             | 主な用途                     |
| ---------- | ---------------- | ---------------------------- |
| Sprint     | スプリント情報   | アクティブスプリントの表示   |
| Story      | ストーリー情報   | ストーリーの表示、状 �� 更新 |
| User       | ユーザー情報     | 担当者の表示                 |
| Project    | プロジェクト情報 | 現在のプロジェクト情報の表示 |

## 2. 画面構成

### 2.1 メイン画面レイアウト

```
+------------------+----------------------------------------+
|     ヘッダー     |                                        |
+------------------+----------------------------------------+
|                  |  +----------+  +----------+  +--------+ |
|    プロジェクト  |  |   ToDo   |  |  Doing   |  |  Done  | |
|      選択        |  |          |  |          |  |        | |
|                  |  | ストーリー |  | ストーリー |  |ストーリー| |
|    メニュー      |  |          |  |          |  |        | |
|                  |  |          |  |          |  |        | |
|                  |  +----------+  +----------+  +--------+ |
+------------------+----------------------------------------+
```

### 2.2 コンテンツ詳細

#### 2.2.1 ストーリーカード

##### 表示項目

| 項目     | データ型 | DB 項目           | 表示形式           |
| -------- | -------- | ----------------- | ------------------ |
| タイトル | 文字列   | Story.title       | テキスト           |
| 状態     | 文字列   | Story.status      | アイコン＋テキスト |
| 担当者   | 整数     | Story.assignee_id | ユーザーアイコン   |
| 優先度   | 整数     | Story.priority    | アイコン（色分け） |
| ポイント | 整数     | Story.points      | 数値               |

## 3. イベント

### 3.1 ストーリー管理

#### 3.1.1 ステータス更新

1. イベント名：ストーリーカードのドラッグ&ドロップ
2. 処理フロー

   1. ドロップ先の列を判定
   2. ストーリーのステータス更新
   3. 列の件数更新
   4. 表示の更新

3. データ更新ロジック

```sql
-- ストーリーのステータス更新
UPDATE stories
SET status = :new_status,
    updated_at = CURRENT_TIMESTAMP
WHERE id = :story_id;
```

4. 結果表現

- 成功時：カードの移動と件数の更新
- 失敗時：元の位置に戻す

### 3.2 表示制御

#### 3.2.1 完了ストーリーの表示

1. イベント名：Done 列のストーリー表示
2. 処理フロー

   1. ストーリーのステータス判定
   2. 完了の場合、タイトルに取り消し線を表示
   3. 状態ラベルのスタイル変更

3. データ検索ロジック

```sql
-- 各ステータスのストーリー取得
SELECT *
FROM stories
WHERE sprint_id = :active_sprint_id
  AND status = :status
ORDER BY priority DESC, created_at ASC;
```

## 4. エラー処理

### 4.1 業務チェック

| チェック内容         | エラーメッセージ                     |
| -------------------- | ------------------------------------ |
| アクティブスプリント | アクティブなスプリントがありません   |
| ストーリーの存在     | 指定されたストーリーが見つかりません |

## 5. 非同期処理

### 5.1 API 一覧

| API 名             | メソッド | 用途                     |
| ------------------ | -------- | ------------------------ |
| /api/story/status  | PUT      | ステータス更新           |
| /api/sprint/active | GET      | アクティブスプリント取得 |

### 5.2 エラーハンドリング

1. 通信エラー時

   - エラーメッセージの表示
   - 自動リトライ（最大 3 回）
   - 失敗時は元の状態に戻す

2. バリデーションエラー時
   - エラーメッセージの表示
   - カードを元の位置に戻す
